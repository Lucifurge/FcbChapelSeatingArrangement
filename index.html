<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>FCB Chapel Seating</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #e0f7fa, #c8e6c9);
  color: #333;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 100%;
}

/* Navbar */
nav {
  width: 100%;
  background: #1b5e20;
  padding: 12px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  color: white;
  position: sticky;
  top: 0;
  z-index: 100;
  flex-wrap: wrap;
}
nav .logo img { height: 45px; width: auto; }
.nav-links { display: flex; align-items: center; flex-wrap: wrap; margin-top: 8px; }
.nav-links a, .nav-links select {
  color: white;
  text-decoration: none;
  margin-left: 15px;
  font-weight: bold;
  background: transparent;
  border: none;
  font-size: 1rem;
  cursor: pointer;
}
.nav-links a:hover { color: #ffd700; }

/* Countdown */
#countdown {
  font-size: 1.1rem;
  margin: 12px auto;
  text-align: center;
  background: rgba(255,255,255,0.25);
  padding: 8px 12px;
  border-radius: 10px;
  font-weight: bold;
  color: #1b5e20;
  min-width: 250px;
  text-shadow: 0 1px 2px rgba(0,0,0,0.2);
}

h1 {
  text-align: center;
  color: #1b5e20;
  font-weight: 900;
  margin: 15px 0;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
  font-size: 2rem;
}

/* Grid seating layout (UPDATED FOR CURVED LAYOUT) */
#grid {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 30px;
  width: 100%;
  padding-top: 60px;
  position: relative;
}

.seat-row {
  display: flex;
  flex-wrap: nowrap;
  justify-content: center;
  gap: 24px;
  overflow-x: auto;
  padding-left: 10px;
  scroll-padding-left: 10px;

  /* NEW curved layout base setup */
  transform: rotate(var(--angle));
  transform-origin: bottom center;
}

.seat {
  padding: 18px 12px;
  text-align: center;
  border-radius: 12px;
  cursor: pointer;
  font-weight: bold;
  color: white;
  background: #43a047;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  transition: all 0.3s ease;
  font-size: 1rem;
  flex-shrink: 0;
}

.seat:hover { transform: scale(1.15); box-shadow: 0 8px 16px rgba(0,0,0,0.35); }

.gold {
  background: linear-gradient(135deg, #ffd700, #ffb300);
  color: #333;
  text-shadow: 0 1px 2px rgba(0,0,0,0.2);
}

.green {
  background: linear-gradient(135deg, #4caf50, #2e7d32);
  color: white;
}

.taken {
  background: #9e9e9e !important;
  cursor: not-allowed;
  color: white !important;
  text-decoration: line-through;
  box-shadow: inset 0 0 8px rgba(0,0,0,0.3);
}

/* Spacer between seat groups */
.spacer { width: 60px; }

/* Tooltip */
.seat[data-timestamp]:hover::after {
  content: attr(data-timestamp);
  position: absolute;
  top: -32px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.85);
  color: #fff;
  padding: 4px 10px;
  border-radius: 6px;
  font-size: 12px;
  white-space: nowrap;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.2s ease;
}
.seat[data-timestamp]:hover::after { opacity: 1; }

/* Responsiveness unchanged */
@media(max-width: 1024px){
  .seat { font-size: 0.9rem; padding: 16px 10px; }
  .spacer { width: 45px; }
  #grid { max-width: 1000px; gap: 22px; }
}

@media(max-width: 768px){
  .seat { font-size: 0.8rem; padding: 14px 8px; }
  .spacer { width: 35px; }
  #grid { max-width: 700px; gap: 18px; }
}

@media(max-width: 480px){
  .seat-row { gap: 10px; justify-content: flex-start; padding-left: 5px; }
  .seat { font-size: 0.65rem; padding: 8px 5px; min-width: 24px; }
  .spacer { width: 18px; }
  #grid { max-width: 100%; padding: 0 5px; gap: 12px; }
  #countdown { font-size: 0.9rem; padding: 5px 8px; }
}
</style>
</head>
<body>

<nav>
  <div class="logo">
    <img src="febias.png" alt="Febias Logo" />
  </div>
  <div class="nav-links">
    <a href="#">Home</a>
    <select id="eventSelector">
      <option value="christmas">Christmas for Christ</option>
      <option value="newyear">New Year Celebration</option>
      <option value="easter">Easter Sunday</option>
    </select>
  </div>
</nav>

<div id="countdown">Event starts in: --:--:--:--</div>
<h1 id="eventTitle">Fcb Chapel Seating</h1>
<div id="grid"></div>

<script>
const rows = 12;
const API_URL = "https://script.google.com/macros/s/AKfycbxeZwyYbQX55n0ZIC0EkcYSYk4WQrJLHgt4a4liR__p8RTjUX86L9UzehW1cb1_Ua30/exec";
const saved = {};

const events = {
  christmas: { name: "Christmas for Christ", startDate: "December 5, 2025 18:00:00", endDate: "December 6, 2025 23:59:59" },
  newyear: { name: "New Year Celebration", date: "January 1, 2026 00:00:00" },
  easter: { name: "Easter Sunday", date: "April 20, 2026 00:00:00" }
};

async function loadReservations() {
  try {
    const res = await fetch(API_URL);
    const text = await res.text();
    let data = [];
    try { data = JSON.parse(text); } catch (e) { console.error('Invalid JSON:', text); }
    data.forEach(item => {
      if (item.seat && item.name && item.timestamp) {
        saved[item.seat] = { name: item.name, timestamp: new Date(item.timestamp).toLocaleString() };
      } else if (item.seat && item.name) {
        saved[item.seat] = { name: item.name, timestamp: "" };
      }
    });
    buildSeats();
  } catch (err) { console.error(err); buildSeats(); }
}

function buildSeats() {
  const gridEl = document.getElementById("grid");
  gridEl.innerHTML = "";

  for (let r = 0; r < rows; r++) {
    const rowEl = document.createElement("div");
    rowEl.className = "seat-row";

    /* âœ… CURVED LAYOUT APPLIED HERE */
    const angle = (r - 5.5) * 3.2;  
    rowEl.style.setProperty("--angle", angle + "deg");

    /* vertical arc effect */
    rowEl.style.marginTop = `${Math.abs(r - 6) * 8}px`;

    const rowLetter = String.fromCharCode(65 + r);

    const isGold = r < 6;
    const seatsInRow = isGold ? 18 : 24;
    const groupSize = isGold ? 6 : 4;
    const spacerWidth = isGold ? "60px" : "50px";

    for (let seatNum = 1; seatNum <= seatsInRow; seatNum++) {
      const id = rowLetter + seatNum;

      const div = document.createElement("div");
      div.className = "seat";
      div.classList.add(isGold ? "gold" : "green");
      div.textContent = id;

      if (saved[id]) {
        div.classList.add("taken");
        div.textContent = `${id} (${saved[id].name})`;
        if (saved[id].timestamp) {
          div.setAttribute("data-timestamp", saved[id].timestamp);
        }
      }

      div.onclick = async () => {
        if (div.classList.contains("taken")) return;
        const name = prompt(`Enter your name to reserve ${id}:`);
        if (!name) return;
        const timestamp = new Date().toLocaleString();
        saved[id] = { name, timestamp };
        div.classList.add("taken");
        div.textContent = `${id} (${name})`;
        div.setAttribute("data-timestamp", timestamp);
        const params = new URLSearchParams({ seat: id, name });
        try { await fetch(API_URL + "?" + params.toString(), { method: "GET" }); }
        catch (err) { console.error(err); }
        loadReservations();
      };

      rowEl.appendChild(div);

      if (seatNum % groupSize === 0 && seatNum !== seatsInRow) {
        const spacer = document.createElement("div");
        spacer.className = "spacer";
        spacer.style.width = spacerWidth;
        rowEl.appendChild(spacer);
      }
    }

    gridEl.appendChild(rowEl);
  }
}

function startCountdown(eventKey) {
  const countdownEl = document.getElementById("countdown");
  const eventTitle = document.getElementById("eventTitle");
  const event = events[eventKey];
  eventTitle.textContent = event.name;
}

document.getElementById("eventSelector").addEventListener("change", e => startCountdown(e.target.value));

loadReservations();
startCountdown("christmas");
setInterval(loadReservations, 3000);
</script>

</body>
</html>
